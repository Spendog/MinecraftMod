package com.example.educationmod.gui;

import net.minecraft.client.gui.GuiScreen;
import net.minecraft.client.gui.GuiButton;
import net.minecraft.client.Minecraft;
import com.example.educationmod.content.QuizContent;
import cpw.mods.fml.relauncher.Side;
import cpw.mods.fml.relauncher.SideOnly;
import net.minecraft.util.EnumChatFormatting;

@SideOnly(Side.CLIENT)
public class QuizScreen extends GuiScreen {
    private final QuizContent quiz;
    private GuiButton[] optionButtons;
    private boolean answered = false;
    private String resultMessage = "";

    public QuizScreen(QuizContent quiz) {
        this.quiz = quiz;
    }

    @Override
    public void initGui() {
        buttonList.clear();
        String[] options = quiz.getOptions();
        optionButtons = new GuiButton[options.length];
        
        int buttonWidth = 200;
        int buttonHeight = 20;
        int startY = height / 2 - ((options.length * (buttonHeight + 5)) / 2);
        
        for (int i = 0; i < options.length; i++) {
            optionButtons[i] = new GuiButton(i, width / 2 - buttonWidth / 2, 
                startY + (i * (buttonHeight + 5)), buttonWidth, buttonHeight, options[i]);
            buttonList.add(optionButtons[i]);
        }
    }

    @Override
    protected void actionPerformed(GuiButton button) {
        if (!answered && button.id >= 0 && button.id < quiz.getOptions().length) {
            answered = true;
            boolean correct = quiz.isCorrectAnswer(button.id);
            resultMessage = correct ? 
                EnumChatFormatting.GREEN + "Correct!" : 
                EnumChatFormatting.RED + "Incorrect! The correct answer was: " + quiz.getCorrectAnswer();
            
            for (GuiButton b : optionButtons) {
                b.enabled = false;
            }
        }
    }

    @Override
    public void drawScreen(int mouseX, int mouseY, float partialTicks) {
        drawDefaultBackground();
        drawCenteredString(fontRendererObj, quiz.getTitle(), width / 2, 20, 0xFFFFFF);
        drawCenteredString(fontRendererObj, quiz.getQuestion(), width / 2, 40, 0xFFFFFF);
        
        if (answered) {
            drawCenteredString(fontRendererObj, resultMessage, width / 2, 
                height / 2 + ((quiz.getOptions().length * 25) / 2) + 10, 0xFFFFFF);
        }
        
        super.drawScreen(mouseX, mouseY, partialTicks);
    }

    @Override
    public boolean doesGuiPauseGame() {
        return true;
    }
}